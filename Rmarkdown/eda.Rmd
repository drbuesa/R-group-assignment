---
title: "**EDA - Solar Energy Prediction**"
author: "GROUP F: ADDISON P., ALBERTO I., DANIEL R., FIDELIS M., VANIA C."
date: "May 22nd 2020"
output:
  html_document:
    fig_caption: yes
    toc: yes
    toc_float: yes
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    toc: yes
---


```{r, echo=FALSE}
# htmltools::img(src =knitr::image_uri(file.path("/bigdata/utiles_sonia", ("logo_ie.jpg"))), alt = 'logo_ie.jpg', style = 'possition:absolute;left; width:450px;')
```


```{r, warning=FALSE, echo=FALSE}
library(rmarkdown)
library(knitr)
opts_chunk$set(warning=FALSE, echo=FALSE, fig.width = 15)
```


```{r,results='hide'}
library(data.table)
library(ggplot2)
library(leaflet)
library(maps)

########################## GLOBAL PATHS ##########################
folder_path <- "../files/";

############################# GLOBAL QUERYS #############################
data <- readRDS(file.path(folder_path, "solar_dataset.RData"));
stations <- fread(file.path(folder_path, "station_info.csv"));
additional_vars <- readRDS(file.path(folder_path, "additional_variables.RData"));

### Station names
stationsNames <- colnames(data)[2:99]
data <- data[1:5113,]

#Select Principal Components
pc <- colnames(data)[100:456];

```

## Solar dataset

The dimension of Solar dataset is `r nrow(data)` x `r ncol(data)`. 

First column is `r colnames(data)[1]` from `r as.Date(data$Date[1], format = "%Y%m%d")` to `r as.Date(data$Date[5113], format = "%Y%m%d")`. 

Next `r length(stationsNames)` contain energy production in solar estations in units of Joules per square meter. 

Finally, there are `r length(pc)` columns with Principal Components that can be used as predictors.



**Location of the 98 Solar Stations**


The followin map shows the location of the stations. 

```{r,results="asis"}  

mapStates = map("state", fill = TRUE, plot = FALSE)

m <- leaflet(data = mapStates, width = 800, height = 400) %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  setView(-97.34, 35.54, zoom = 10) %>%
  fitBounds(-104.00, 38.80, -94.00, 33.20) %>%
  addPolygons(fillColor = topo.colors(10, alpha = NULL), stroke = FALSE) %>%
  addCircles(data = stations, lng = ~elon, lat = ~nlat, popup = ~stid, color = 'red');
m 
```

Click the red dots to know the name of a particular station. 


**Solar Stations Data**  

As the stations are close between them, their data are very similar. 

As an example, information about ACME station is shown:

Summary

```{r}
summary(data[, ACME])
```

Number of missing values: 

```{r}
sum(is.na(data));
```



```{r}
boxplot(data[, ACME], main = "Boxplot ACME");
```


```{r}
plot(density(data$ACME), col = "blue", main = "Density function ACME")
```

## Principal Components Analysis

```{r,results="asis"}

variance <- sapply(data[, ..pc], var);
prop_var <- variance / sum(variance);

ggplot(data.frame(prop_var[1:10]),
       aes(x = 1:10 , y = prop_var[1:10])) +
  geom_col(width = 0.7) +
  geom_line(col = "blue") +
  theme_bw() +
  labs(x = "Principal Component",
       y = "Percentage of Explained Variance") +
  scale_x_discrete(labels = paste0("PC", seq(1,10)), limits = c(1:10))

```





